<!-- INCLUDE overall_header.html -->
<h1>{L_ACP_SIMPLEDOWN_TITLE} - {L_ACP_SIMPLEDOWN_EXISTING_FILES}</h1>

<form id="acp_simpledown" method="post" action="{U_ACTION}" enctype="multipart/form-data">
    {S_FORM_TOKEN}

    <!-- MODO EDIÇÃO DE ARQUIVO -->
    <!-- IF S_EDIT_MODE -->
    <fieldset>
        <legend>{L_ACP_SIMPLEDOWN_EDIT_DESCRIPTION}: <strong>{EDIT_FILE_NAME}</strong></legend>
        <input type="hidden" name="action" value="edit" />
        <input type="hidden" name="id" value="{EDIT_FILE_ID}" />
        <dl>
            <dt><label for="edit_file_name">{L_ACP_SIMPLEDOWN_FILE_NAME}:</label><br />
                <span>{L_ACP_SIMPLEDOWN_FILE_NAME_EXPLAIN}</span>
            </dt>
            <dd><input type="text" id="edit_file_name" name="edit_file_name" value="{EDIT_FILE_NAME}" maxlength="255" size="50" /></dd>
        </dl>
        <dl>
            <dt><label for="edit_file_desc_short">{L_ACP_SIMPLEDOWN_SHORT_DESCRIPTION}:</label></dt>
            <dd><textarea id="edit_file_desc_short" name="edit_file_desc_short" rows="3" cols="60">{EDIT_FILE_DESC_SHORT}</textarea></dd>
        </dl>
        <dl>
            <dt><label for="edit_file_desc">{L_ACP_SIMPLEDOWN_DESCRIPTION}:</label></dt>
            <dd><textarea id="edit_file_desc" name="edit_file_desc" rows="6" cols="60">{EDIT_FILE_DESC}</textarea></dd>
        </dl>
        <dl>
            <dt><label for="edit_file_version">{L_ACP_SIMPLEDOWN_VERSION}:</label><br />
                <span>{L_ACP_SIMPLEDOWN_VERSION_EXPLAIN}</span>
            </dt>
            <dd><input type="text" id="edit_file_version" name="edit_file_version" value="{EDIT_FILE_VERSION}" maxlength="50" size="20" /></dd>
        </dl>
        <dl>
            <dt><label for="edit_category">{L_ACP_SIMPLEDOWN_CATEGORY}:</label></dt>
            <dd>
                <select id="edit_category" name="edit_category">
                    <option value="0">{L_ACP_SIMPLEDOWN_NO_CATEGORY}</option>
                    <!-- BEGIN categories -->
                    <option value="{categories.ID}" <!-- IF categories.ID == EDIT_FILE_CAT_ID -->selected="selected"<!-- ENDIF -->>{categories.NAME}</option>
                    <!-- END categories -->
                </select>
            </dd>
        </dl>
        <dl>
            <dt><label>{L_ACP_SIMPLEDOWN_REPLACE_FILE}:</label><br />
                <span>{L_ACP_SIMPLEDOWN_REPLACE_FILE_EXPLAIN}</span>
            </dt>
            <dd>
                <div class="custom-file-upload">
                    <input type="file" id="replace_upload" name="replace_upload" />
                    <label for="replace_upload" class="custom-file-label">
                        <span>{L_ACP_SIMPLEDOWN_CHOOSE_FILE}</span>
                    </label>
                    <span class="file-name-display" id="replace-file-name-display">{L_ACP_SIMPLEDOWN_NO_FILE_SELECTED}</span>
                </div>
            </dd>
        </dl>
        <p class="submit-buttons">
            <input class="button1" type="submit" name="submit_edit" value="{L_ACP_SIMPLEDOWN_SAVE_CHANGES}" />
            <input class="button2" type="button" onclick="window.location.href='{U_ACTION}';" value="{L_ACP_SIMPLEDOWN_CANCEL}" />
        </p>
    </fieldset>
    <!-- ENDIF -->

    <!-- LISTAGEM DE ARQUIVOS -->
    <fieldset>
        <legend>{L_ACP_SIMPLEDOWN_EXISTING_FILES}</legend>

        <!-- Controles superiores -->
        <div class="acp-controls-top">
            <div class="control-item">
                <label for="perpage_select">{L_ACP_SIMPLEDOWN_ITEMS_PER_PAGE}:</label>
                <form method="get" action="{U_ACTION}" class="inline-form">
                    <input type="hidden" name="mode" value="files" />
                    <select id="perpage_select" name="perpage" onchange="this.form.submit()">
                        <option value="10" <!-- IF PERPAGE == 10 -->selected<!-- ENDIF -->>10</option>
                        <option value="20" <!-- IF PERPAGE == 20 -->selected<!-- ENDIF -->>20</option>
                        <option value="50" <!-- IF PERPAGE == 50 -->selected<!-- ENDIF -->>50</option>
                        <option value="100" <!-- IF PERPAGE == 100 -->selected<!-- ENDIF -->>100</option>
                        <option value="0" <!-- IF PERPAGE == 0 -->selected<!-- ENDIF -->>{L_ALL}</option>
                    </select>
                </form>
            </div>
            <div class="control-item search-item">
                <label for="search_input">{L_ACP_SIMPLEDOWN_SEARCH_FILES}:</label>
                <input type="text" id="search_input" placeholder="{L_ACP_SIMPLEDOWN_SEARCH_PLACEHOLDER}" />
            </div>
            <div class="control-item total-item">
                {L_ACP_SIMPLEDOWN_TOTAL_FILES}: <strong>{TOTAL_FILES}</strong>
            </div>
        </div>

        <!-- Paginação no topo -->
        <!-- IF ACP_TOTAL_PAGES > 1 -->
        <div class="acp-pagination">
            <span>{L_ACP_SIMPLEDOWN_PAGINATION_INFO}: {ACP_CURRENT_PAGE} / {ACP_TOTAL_PAGES}</span>
            <div class="acp-pagination-buttons">
                <!-- IF ACP_PREV_PAGE -->
                <a href="{ACP_PREV_PAGE}" class="button2">&laquo; {L_PREVIOUS}</a>
                <!-- ENDIF -->
                <!-- IF ACP_NEXT_PAGE -->
                <a href="{ACP_NEXT_PAGE}" class="button2">{L_NEXT} &raquo;</a>
                <!-- ENDIF -->
            </div>
        </div>
        <!-- ENDIF -->

        <!-- Tabela de arquivos -->
        <!-- IF .files -->
        <table class="table1 compact-table">
            <thead>
                <tr>
                    <th>{L_ACP_SIMPLEDOWN_FILE_NAME}</th>
                    <th>{L_ACP_SIMPLEDOWN_VERSION}</th>
                    <th>{L_ACP_SIMPLEDOWN_CATEGORY_NAME}</th>
                    <th>{L_ACP_SIMPLEDOWN_DOWNLOADS} / {L_ACP_SIMPLEDOWN_SIZE}</th>
                    <th>{L_ACP_SIMPLEDOWN_ACTIONS}</th>
                </tr>
            </thead>
            <tbody>
                <!-- BEGIN files -->
                <tr>
                    <td>
                        <strong>{files.NAME}</strong><br />
                        <span class="desc-short">
                            {files.DESC_SHORT}
                            <!-- IF files.DESC_FORMATTED -->
                            <span class="view-full-desc" data-desc="{files.DESC_FORMATTED}" title="{L_ACP_SIMPLEDOWN_VIEW_FULL_DESC}">
                                <i class="fa fa-eye"></i>
                            </span>
                            <!-- ENDIF -->
                        </span><br />
                        <small><i class="icon fa-fw {files.FILE_ICON}"></i> {files.REAL_NAME}</small>
                    </td>
                    <td>{files.VERSION}</td>
                    <td>{files.CAT}</td>
                    <td>{files.DOWNLOADS} / {files.SIZE}</td>
                    <td>
                        <a href="{files.U_EDIT}" class="button2">{L_ACP_SIMPLEDOWN_EDIT}</a>
                        <a href="{files.U_DELETE}" class="button2 danger">{L_ACP_SIMPLEDOWN_DELETE}</a>
                    </td>
                </tr>
                <!-- END files -->
            </tbody>
        </table>
        <!-- ELSE -->
        <p>{L_ACP_SIMPLEDOWN_NO_FILES_YET}</p>
        <!-- ENDIF -->

        <!-- Paginação no rodapé -->
        <!-- IF ACP_TOTAL_PAGES > 1 -->
        <div class="acp-pagination">
            <span>{L_ACP_SIMPLEDOWN_PAGINATION_INFO}: {ACP_CURRENT_PAGE} / {ACP_TOTAL_PAGES}</span>
            <div class="acp-pagination-buttons">
                <!-- IF ACP_PREV_PAGE -->
                <a href="{ACP_PREV_PAGE}" class="button2">&laquo; {L_PREVIOUS}</a>
                <!-- ENDIF -->
                <!-- IF ACP_NEXT_PAGE -->
                <a href="{ACP_NEXT_PAGE}" class="button2">{L_NEXT} &raquo;</a>
                <!-- ENDIF -->
            </div>
        </div>
        <!-- ENDIF -->
    </fieldset>

    {S_FORM_TOKEN}
</form>

<!-- Modal para visualizar descrição completa -->
<div id="desc-modal" class="modal">
    <div>
        <span class="close-modal" title="{L_CLOSE}">&times;</span>
        <h3>{L_ACP_SIMPLEDOWN_DESCRIPTION}</h3>
        <div id="full-desc-content"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Busca dinâmica
    const searchInput = document.getElementById('search_input');
    const rows = document.querySelectorAll('.compact-table tbody tr');
    if (searchInput && rows.length) {
        searchInput.addEventListener('input', () => {
            const filter = searchInput.value.toLowerCase().trim();
            rows.forEach(row => {
                const name = row.querySelector('td:first-child strong')?.textContent.toLowerCase() || '';
                row.style.display = name.includes(filter) ? '' : 'none';
            });
        });
    }

    // Nome do arquivo selecionado (edição)
    const replaceInput = document.getElementById('replace_upload');
    const replaceDisplay = document.getElementById('replace-file-name-display');
    if (replaceInput && replaceDisplay) {
        replaceInput.addEventListener('change', e => {
            replaceDisplay.textContent = e.target.files.length ? e.target.files[0].name : '{L_ACP_SIMPLEDOWN_NO_FILE_SELECTED}';
        });
    }

    // Modal de descrição completa
    document.querySelector('.compact-table')?.addEventListener('click', e => {
        const trigger = e.target.closest('.view-full-desc');
        if (trigger) {
            const desc = trigger.getAttribute('data-desc');
            const content = document.getElementById('full-desc-content');
            const modal = document.getElementById('desc-modal');
            if (content && modal && desc) {
                content.innerHTML = desc;
                modal.style.display = 'block';
            }
        }
    });

    // Fechar modal
    document.querySelector('.close-modal')?.addEventListener('click', () => {
        document.getElementById('desc-modal').style.display = 'none';
    });

    // Fechar com ESC
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') document.getElementById('desc-modal').style.display = 'none';
    });
});
</script>

<!-- INCLUDECSS @mundophpbb_simpledown/acp_simpledown.css -->
<!-- INCLUDE overall_footer.html -->